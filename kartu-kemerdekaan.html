<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kartu HUT Kemerdekaan RI</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;900&family=EB+Garamond:ital,wght@0,400;0,600;1,400&family=Playfair+Display:ital,wght@0,700;1,700&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0508;--panel:#180b0d;--bdr:rgba(220,40,40,.18);--red:#dc2626;--gold:#f59e0b;--gold2:#fde68a;--white:#fff8f0;--ash:#b08080;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);background-image:radial-gradient(ellipse at 20% 10%,rgba(180,20,20,.35) 0%,transparent 55%),radial-gradient(ellipse at 80% 90%,rgba(120,10,10,.3) 0%,transparent 55%);color:var(--white);font-family:'EB Garamond',serif;min-height:100vh;}
.site-header{text-align:center;padding:1.8rem 1rem 1.3rem;border-bottom:1px solid var(--bdr);background:rgba(0,0,0,.35);backdrop-filter:blur(6px);position:sticky;top:0;z-index:100;}
.site-header span{font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.3em;color:var(--red);display:block;margin-bottom:.25rem;}
.site-header h1{font-family:'Cinzel',serif;font-size:clamp(1.1rem,3vw,1.7rem);font-weight:900;color:var(--gold2);letter-spacing:.1em;}
.workspace{display:flex;min-height:calc(100vh - 72px);}
.sidebar{width:310px;min-width:270px;max-width:310px;background:var(--panel);border-right:1px solid var(--bdr);padding:1.4rem;overflow-y:auto;max-height:calc(100vh - 72px);position:sticky;top:72px;}
.sidebar::-webkit-scrollbar{width:4px;}.sidebar::-webkit-scrollbar-thumb{background:rgba(220,40,40,.3);border-radius:4px;}
.s-section{margin-bottom:1.3rem;}
.s-title{font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.22em;color:var(--red);display:flex;align-items:center;gap:.6rem;margin-bottom:.8rem;}
.s-title::after{content:'';flex:1;height:1px;background:var(--bdr);}
.field{margin-bottom:.8rem;}.field label{display:block;font-size:.8rem;color:var(--ash);margin-bottom:.28rem;}
.field input,.field textarea{width:100%;background:rgba(255,255,255,.05);border:1px solid var(--bdr);color:var(--white);font-family:'EB Garamond',serif;font-size:.93rem;padding:.5rem .75rem;border-radius:3px;outline:none;transition:border-color .25s;}
.field input:focus,.field textarea:focus{border-color:rgba(220,40,40,.5);}
.field textarea{resize:vertical;min-height:80px;line-height:1.55;}
.upload-zone{border:2px dashed rgba(220,40,40,.3);border-radius:6px;padding:1.1rem;text-align:center;cursor:pointer;transition:all .3s;position:relative;}
.upload-zone:hover{border-color:var(--red);background:rgba(220,40,40,.06);}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-zone .icon{font-size:1.6rem;margin-bottom:.3rem;}.upload-zone p{font-size:.78rem;color:var(--ash);}
.upload-zone p strong{color:var(--red);display:block;}
.thumb-preview{width:66px;height:66px;border-radius:50%;object-fit:cover;border:2px solid var(--red);margin:.6rem auto 0;display:none;}
.tmpl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.45rem;}
.tmpl-item{border:2px solid var(--bdr);border-radius:4px;cursor:pointer;overflow:hidden;aspect-ratio:4/3;background:#100;transition:border-color .25s,transform .2s;position:relative;}
.tmpl-item:hover{border-color:rgba(220,40,40,.7);transform:scale(1.03);}
.tmpl-item.active{border-color:var(--red);}
.tmpl-item canvas{width:100%;height:100%;display:block;}
.tmpl-item .lbl{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);font-family:'Cinzel',serif;font-size:.42rem;letter-spacing:.06em;color:var(--gold2);text-align:center;padding:2px 0;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:.45rem;}
.toggle-row>span{font-size:.8rem;color:var(--ash);}
.sw{position:relative;width:36px;height:19px;cursor:pointer;}.sw input{display:none;}
.sw-track{position:absolute;inset:0;background:rgba(255,255,255,.08);border-radius:20px;border:1px solid var(--bdr);transition:background .3s;}
.sw-track::after{content:'';position:absolute;top:2px;left:2px;width:13px;height:13px;background:var(--ash);border-radius:50%;transition:transform .3s,background .3s;}
.sw input:checked+.sw-track{background:rgba(220,40,40,.2);}
.sw input:checked+.sw-track::after{transform:translateX(17px);background:var(--red);}
.color-row{display:flex;gap:.4rem;flex-wrap:wrap;}
.cdot{width:24px;height:24px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;}
.cdot:hover,.cdot.active{border-color:var(--gold);transform:scale(1.2);}
.size-pills{display:flex;gap:.4rem;flex-wrap:wrap;}
.size-pill{padding:.3rem .7rem;border:1px solid var(--bdr);border-radius:20px;font-family:'Cinzel',serif;font-size:.57rem;letter-spacing:.08em;color:var(--ash);cursor:pointer;transition:all .25s;background:none;}
.size-pill:hover,.size-pill.active{border-color:var(--red);color:var(--red);background:rgba(220,40,40,.08);}
.btn-dl{width:100%;padding:.78rem;margin-top:.5rem;background:linear-gradient(135deg,#7a0000,var(--red),#7a0000);background-size:200%;border:none;color:#fff8f0;font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.14em;cursor:pointer;border-radius:3px;transition:background-position .4s,transform .2s;}
.btn-dl:hover{background-position:100%;transform:translateY(-1px);}
.btn-ref{width:100%;padding:.65rem;margin-top:.4rem;background:transparent;border:1px solid rgba(220,40,40,.35);color:var(--gold2);font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.1em;cursor:pointer;border-radius:3px;transition:all .3s;}
.btn-ref:hover{background:rgba(220,40,40,.1);}
.main-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:2rem 1.5rem 4rem;gap:1rem;overflow-y:auto;}
.canvas-label{font-family:'Cinzel',serif;font-size:.58rem;letter-spacing:.2em;color:var(--ash);text-align:center;}
#mainCanvas{width:min(600px,92vw);box-shadow:0 20px 80px rgba(0,0,0,.8),0 0 0 1px rgba(220,40,40,.2);border-radius:3px;display:block;cursor:pointer;transition:box-shadow .3s;}
#mainCanvas:hover{box-shadow:0 24px 90px rgba(0,0,0,.85),0 0 0 1px rgba(220,40,40,.6),0 0 60px rgba(220,40,40,.12);}
.canvas-hint{font-size:.75rem;font-style:italic;color:var(--ash);text-align:center;}
@media(max-width:720px){.workspace{flex-direction:column;}.sidebar{width:100%;max-width:100%;max-height:none;position:static;border-right:none;border-bottom:1px solid var(--bdr);}}
</style>
</head>
<body>
<div class="site-header">
  <span>üáÆüá© DIRGAHAYU REPUBLIK INDONESIA üáÆüá©</span>
  <h1>Kartu HUT Kemerdekaan RI</h1>
</div>
<div class="workspace">
<aside class="sidebar">
  <div class="s-section">
    <div class="s-title">Foto / Logo</div>
    <div class="upload-zone"><input type="file" accept="image/*" id="photoInput"><div class="icon">üñºÔ∏è</div><p><strong>Upload Foto/Logo</strong>JPG, PNG</p></div>
    <img id="photoThumb" class="thumb-preview">
  </div>
  <div class="s-section">
    <div class="s-title">Template</div>
    <div class="tmpl-grid" id="tmplGrid"></div>
  </div>
  <div class="s-section">
    <div class="s-title">Ukuran</div>
    <div class="size-pills">
      <button class="size-pill active" data-w="1080" data-h="1080">1:1 Post</button>
      <button class="size-pill" data-w="1080" data-h="1920">9:16 Story</button>
      <button class="size-pill" data-w="1080" data-h="1350">4:5 Feed</button>
      <button class="size-pill" data-w="1200" data-h="628">FB Cover</button>
    </div>
  </div>
  <div class="s-section">
    <div class="s-title">Informasi</div>
    <div class="field"><label>Ke- (angka HUT)</label><input type="text" id="fAngka" value="80"></div>
    <div class="field"><label>Tahun</label><input type="text" id="fTahun" value="2025"></div>
    <div class="field"><label>Nama Instansi / Pribadi</label><input type="text" id="fNama" value="Keluarga Besar PT. Nusantara Jaya"></div>
    <div class="field"><label>Jabatan / Keterangan</label><input type="text" id="fJabatan" value=""></div>
    <div class="field"><label>Motto / Tema HUT</label><input type="text" id="fMotto" value="Nusantara Baru, Indonesia Maju"></div>
    <div class="field"><label>Pesan / Doa</label><textarea id="fPesan">Dengan semangat persatuan dan kesatuan, mari kita wujudkan cita-cita para pahlawan untuk Indonesia yang lebih maju, adil, dan sejahtera.</textarea></div>
    <div class="field"><label>Sosmed / Website</label><input type="text" id="fSocial" value="@nusantarajaya.id"></div>
  </div>
  <div class="s-section">
    <div class="s-title">Warna Tema</div>
    <div class="color-row" id="colorRow"></div>
  </div>
  <div class="s-section">
    <div class="s-title">Elemen</div>
    <div class="toggle-row"><span>Ornamen Garuda/Bintang</span><label class="sw"><input type="checkbox" id="tOrnament" checked><span class="sw-track"></span></label></div>
    <div class="toggle-row"><span>Bendera Merah Putih</span><label class="sw"><input type="checkbox" id="tFlag" checked><span class="sw-track"></span></label></div>
    <div class="toggle-row"><span>Bingkai / Border</span><label class="sw"><input type="checkbox" id="tBorder" checked><span class="sw-track"></span></label></div>
    <div class="toggle-row"><span>Nama Instansi</span><label class="sw"><input type="checkbox" id="tNama" checked><span class="sw-track"></span></label></div>
    <div class="toggle-row"><span>Akun Sosmed</span><label class="sw"><input type="checkbox" id="tSocial" checked><span class="sw-track"></span></label></div>
  </div>
  <button class="btn-dl" onclick="doDownload()">‚¨á UNDUH KARTU PNG</button>
  <button class="btn-ref" onclick="doRender()">‚Üª PERBARUI PRATINJAU</button>
</aside>
<main class="main-area">
  <div class="canvas-label">‚ú¶ PRATINJAU KARTU ‚ú¶</div>
  <canvas id="mainCanvas" width="1080" height="1080"></canvas>
  <p class="canvas-hint">Klik kartu untuk mengunduh ¬∑ Resolusi tinggi siap cetak</p>
</main>
</div>
<canvas id="renderCanvas" width="1080" height="1080" style="display:none"></canvas>
<script>
const S={template:0,theme:0,cw:1080,ch:1080,photoImg:null};
const THEMES=[
  {name:'Merah Putih',bg:'#1a0000',bg2:'#2a0808',red:'#dc2626',white:'#fff8f0',gold:'#f59e0b',gold2:'#fde68a',ink:'#fff8f0',sub:'#fca5a5'},
  {name:'Emas Nasional',bg:'#1a1200',bg2:'#2a1e00',red:'#f59e0b',white:'#fff8e0',gold:'#dc2626',gold2:'#fde68a',ink:'#fff8e0',sub:'#fde68a'},
  {name:'Navy Bangsa',bg:'#000d1a',bg2:'#001428',red:'#3b82f6',white:'#e0f0ff',gold:'#f59e0b',gold2:'#fde68a',ink:'#e0f0ff',sub:'#93c5fd'},
  {name:'Hijau Nusantara',bg:'#001a0a',bg2:'#002a12',red:'#16a34a',white:'#e0ffe8',gold:'#f59e0b',gold2:'#fde68a',ink:'#e0ffe8',sub:'#86efac'},
  {name:'Klasik Sepia',bg:'#1a1208',bg2:'#2a1e10',red:'#c2410c',white:'#fdf0dc',gold:'#d97706',gold2:'#fde68a',ink:'#fdf0dc',sub:'#fed7aa'},
];
const TMPL_NAMES=['Heroik Merah','Bendera Agung','Bintang Emas','Klasik Nasional','Modern Bold'];
function rgba(h,a){const r=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),b=parseInt(h.slice(5,7),16);return`rgba(${r},${g},${b},${a})`;}
function wrapLines(ctx,text,maxW){const words=text.split(' ');const lines=[];let cur='';words.forEach(w=>{const t=cur?cur+' '+w:w;if(ctx.measureText(t).width>maxW&&cur){lines.push(cur);cur=w;}else cur=t;});if(cur)lines.push(cur);return lines;}
function fillWrapped(ctx,text,x,y,maxW,lh){const lines=wrapLines(ctx,text,maxW);lines.forEach((l,i)=>ctx.fillText(l,x,y+i*lh));return lines.length*lh;}
function drawGLine(ctx,cx,y,hw,color,lw=1.5){const g=ctx.createLinearGradient(cx-hw,y,cx+hw,y);g.addColorStop(0,'transparent');g.addColorStop(.35,color);g.addColorStop(.65,color);g.addColorStop(1,'transparent');ctx.save();ctx.strokeStyle=g;ctx.lineWidth=lw;ctx.beginPath();ctx.moveTo(cx-hw,y);ctx.lineTo(cx+hw,y);ctx.stroke();ctx.restore();}

// Draw Indonesian flag
function drawFlag(ctx,x,y,w,h,shadow=true){
  if(shadow){ctx.save();ctx.shadowColor='rgba(0,0,0,.5)';ctx.shadowBlur=15;ctx.shadowOffsetY=5;}
  ctx.fillStyle='#dc2626';ctx.fillRect(x,y,w,h/2);
  ctx.fillStyle='#ffffff';ctx.fillRect(x,y+h/2,w,h/2);
  if(shadow)ctx.restore();
  ctx.strokeStyle='rgba(0,0,0,.3)';ctx.lineWidth=1;ctx.strokeRect(x,y,w,h);
}

// Draw star
function drawStar(ctx,cx,cy,r,color,alpha=1){
  ctx.save();ctx.globalAlpha*=alpha;ctx.fillStyle=color;ctx.beginPath();
  for(let i=0;i<10;i++){const a=i*Math.PI/5-Math.PI/2;const rd=i%2===0?r:r*.4;i===0?ctx.moveTo(cx+Math.cos(a)*rd,cy+Math.sin(a)*rd):ctx.lineTo(cx+Math.cos(a)*rd,cy+Math.sin(a)*rd);}
  ctx.closePath();ctx.fill();ctx.restore();
}

// Garuda wings simplified
function drawWings(ctx,cx,cy,size,color,alpha=.7){
  ctx.save();ctx.globalAlpha*=alpha;ctx.fillStyle=color;
  [-1,1].forEach(dir=>{
    ctx.save();ctx.translate(cx,cy);ctx.scale(dir,1);
    // wing feathers
    for(let i=0;i<5;i++){
      const a=(-0.3-i*0.18);const len=size*(0.6+i*.08);
      ctx.beginPath();ctx.moveTo(0,0);
      ctx.lineTo(Math.cos(a)*len,Math.sin(a)*len);
      ctx.lineTo(Math.cos(a-0.12)*len*.85,Math.sin(a-0.12)*len*.85);
      ctx.closePath();ctx.fillStyle=i%2===0?color:rgba(color,.6);ctx.fill();
    }
    ctx.restore();
  });
  ctx.restore();
}

function drawCirclePhoto(ctx,photo,cx,cy,r,borderColor){
  ctx.save();ctx.shadowColor='rgba(0,0,0,.6)';ctx.shadowBlur=20;ctx.shadowOffsetY=6;
  ctx.beginPath();ctx.arc(cx,cy,r+6,0,Math.PI*2);ctx.fillStyle=borderColor;ctx.fill();
  ctx.shadowColor='transparent';
  ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.clip();
  if(photo){const sc=Math.max(r*2/photo.width,r*2/photo.height);ctx.drawImage(photo,cx-photo.width*sc/2,cy-photo.height*sc/2,photo.width*sc,photo.height*sc);}
  else{ctx.fillStyle=rgba(borderColor,.15);ctx.fill();}
  ctx.restore();
}

function drawBg(ctx,W,H,theme){
  const g=ctx.createLinearGradient(0,0,W,H);g.addColorStop(0,theme.bg2);g.addColorStop(1,theme.bg);ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  const vg=ctx.createRadialGradient(W/2,H/2,H*.08,W/2,H/2,H*.75);vg.addColorStop(0,'transparent');vg.addColorStop(1,'rgba(0,0,0,.55)');ctx.fillStyle=vg;ctx.fillRect(0,0,W,H);
}

function getVals(){return{
  angka:document.getElementById('fAngka').value,tahun:document.getElementById('fTahun').value,
  nama:document.getElementById('fNama').value,jabatan:document.getElementById('fJabatan').value,
  motto:document.getElementById('fMotto').value,pesan:document.getElementById('fPesan').value,
  social:document.getElementById('fSocial').value,
  ornament:document.getElementById('tOrnament').checked,flag:document.getElementById('tFlag').checked,
  border:document.getElementById('tBorder').checked,showNama:document.getElementById('tNama').checked,
  showSocial:document.getElementById('tSocial').checked,
};}

// ‚îÄ‚îÄ T0: HEROIK MERAH ‚îÄ‚îÄ
function renderT0(ctx,W,H,theme,v,photo){
  drawBg(ctx,W,H,theme);
  const cx=W/2;
  // Red stripe top
  const rh=H*.12;
  const rg=ctx.createLinearGradient(0,0,W,rh);rg.addColorStop(0,rgba(theme.red,.9));rg.addColorStop(1,rgba(theme.red,.6));
  ctx.fillStyle=rg;ctx.fillRect(0,0,W,rh);
  // White stripe bottom
  const wg=ctx.createLinearGradient(0,H-rh,W,H);wg.addColorStop(0,rgba(theme.white,.12));wg.addColorStop(1,rgba(theme.white,.06));
  ctx.fillStyle=wg;ctx.fillRect(0,H-rh,W,rh);
  if(v.border){ctx.strokeStyle=rgba(theme.gold,.6);ctx.lineWidth=2;ctx.strokeRect(W*.03,rh+W*.02,W*.94,H-rh*2-W*.04);ctx.strokeStyle=rgba(theme.gold,.25);ctx.lineWidth=.8;ctx.strokeRect(W*.04,rh+W*.03,W*.92,H-rh*2-W*.06);}
  // Stars in red bar
  if(v.ornament){[cx-W*.25,cx,cx+W*.25].forEach(x=>drawStar(ctx,x,rh/2,W*.025,rgba(theme.gold,1)));}
  // Wings
  if(v.ornament)drawWings(ctx,cx,H*.32,W*.28,theme.gold,.45);
  // Number
  ctx.font=`900 ${W*.18}px 'Oswald',sans-serif`;
  ctx.fillStyle=theme.gold2;ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(v.angka,cx,H*.32);ctx.textBaseline='alphabetic';
  // HUT
  ctx.font=`${W*.032}px 'Oswald',sans-serif`;ctx.fillStyle=rgba(theme.white,.85);ctx.textAlign='center';
  ctx.fillText('DIRGAHAYU ‚Äî HUT KE-',cx,H*.47);
  ctx.font=`700 ${W*.026}px 'Cinzel',serif`;ctx.fillStyle=theme.gold;ctx.textAlign='center';
  ctx.fillText('REPUBLIK INDONESIA',cx,H*.505);
  ctx.font=`${W*.022}px 'Cinzel',serif`;ctx.fillStyle=theme.gold2;ctx.textAlign='center';
  ctx.fillText(v.tahun,cx,H*.54);
  drawGLine(ctx,cx,H*.56,W*.35,theme.gold,2);
  if(photo)drawCirclePhoto(ctx,photo,cx,H*.65,W*.1,theme.gold);
  const afterPhoto=photo?H*.65+W*.1+W*.03:H*.58;
  if(v.showNama&&v.nama){ctx.font=`bold ${W*.025}px 'EB Garamond',serif`;ctx.fillStyle=theme.white;ctx.textAlign='center';ctx.fillText(v.nama,cx,afterPhoto+W*.025);}
  if(v.jabatan){ctx.font=`italic ${W*.02}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.sub,.9);ctx.textAlign='center';ctx.fillText(v.jabatan,cx,afterPhoto+W*.055);}
  drawGLine(ctx,cx,afterPhoto+W*.072,W*.28,theme.gold);
  ctx.font=`${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.white,.7);ctx.textAlign='center';
  fillWrapped(ctx,v.motto,cx,afterPhoto+W*.095,W*.72,W*.028);
  if(v.showSocial&&v.social){ctx.font=`${W*.017}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.gold,.7);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.96);}
}

// ‚îÄ‚îÄ T1: BENDERA AGUNG ‚îÄ‚îÄ
function renderT1(ctx,W,H,theme,v,photo){
  // Split red/white background
  ctx.fillStyle=theme.red;ctx.fillRect(0,0,W,H/2);
  ctx.fillStyle='#f8f0e0';ctx.fillRect(0,H/2,W,H/2);
  // Vignette
  const vg=ctx.createRadialGradient(W/2,H/2,H*.1,W/2,H/2,H*.75);vg.addColorStop(0,'transparent');vg.addColorStop(1,'rgba(0,0,0,.4)');ctx.fillStyle=vg;ctx.fillRect(0,0,W,H);
  if(v.border){ctx.strokeStyle=theme.gold;ctx.lineWidth=3;ctx.strokeRect(W*.035,H*.035,W*.93,H*.93);ctx.strokeStyle=rgba(theme.gold,.4);ctx.lineWidth=1;ctx.strokeRect(W*.05,H*.05,W*.9,H*.9);}
  const cx=W/2;
  // Wings both halves
  if(v.ornament){drawWings(ctx,cx,H*.28,W*.3,theme.gold,.5);drawWings(ctx,cx,H*.72,W*.3,rgba('#1a0000',1),.15);}
  // Angka big center
  ctx.font=`900 ${W*.22}px 'Oswald',sans-serif`;ctx.textAlign='center';ctx.textBaseline='middle';
  // top half (on red) - white
  ctx.save();ctx.beginPath();ctx.rect(0,0,W,H/2);ctx.clip();ctx.fillStyle='rgba(255,248,240,.9)';ctx.fillText(v.angka,cx,H*.28);ctx.restore();
  // bottom half (on white) - red
  ctx.save();ctx.beginPath();ctx.rect(0,H/2,W,H/2);ctx.clip();ctx.fillStyle=rgba(theme.red,.9);ctx.fillText(v.angka,cx,H*.28);ctx.restore();
  ctx.textBaseline='alphabetic';
  // Gold divider strip center
  ctx.fillStyle=theme.gold;ctx.fillRect(0,H/2-2,W,4);
  // Stars on gold strip
  if(v.ornament){for(let i=-2;i<=2;i++)drawStar(ctx,cx+i*W*.1,H/2,W*.018,rgba('#1a0000',1));}
  ctx.font=`700 ${W*.024}px 'Cinzel',serif`;ctx.fillStyle=rgba('#fff8f0',.95);ctx.textAlign='center';ctx.fillText('DIRGAHAYU HUT KE ‚Äî REPUBLIK INDONESIA',cx,H*.38);
  ctx.font=`${W*.02}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.gold2,.9);ctx.textAlign='center';ctx.fillText(v.tahun,cx,H*.415);
  // Bottom half
  if(photo)drawCirclePhoto(ctx,photo,cx,H*.62,W*.09,theme.red);
  const afterPhoto=photo?H*.62+W*.09+W*.025:H*.57;
  if(v.showNama&&v.nama){ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.red,.9);ctx.textAlign='center';ctx.fillText(v.nama,cx,afterPhoto+W*.022);}
  ctx.font=`${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgba('#1a0000',.7);ctx.textAlign='center';
  fillWrapped(ctx,v.motto,cx,afterPhoto+W*.052,W*.7,W*.028);
  if(v.showSocial&&v.social){ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.red,.6);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.96);}
}

// ‚îÄ‚îÄ T2: BINTANG EMAS ‚îÄ‚îÄ
function renderT2(ctx,W,H,theme,v,photo){
  drawBg(ctx,W,H,theme);
  const cx=W/2;
  if(v.ornament){// Star field
    for(let i=0;i<50;i++){const x=Math.random()*W,y=Math.random()*H;const s=Math.random()*2+.5;ctx.save();ctx.globalAlpha=Math.random()*.6+.1;ctx.fillStyle=theme.gold2;ctx.beginPath();ctx.arc(x,y,s,0,Math.PI*2);ctx.fill();ctx.restore();}
    // Big stars corners
    [[W*.1,H*.1],[W*.9,H*.1],[W*.1,H*.9],[W*.9,H*.9],[cx,H*.08]].forEach(([x,y])=>drawStar(ctx,x,y,W*.025,rgba(theme.gold,.5)));
  }
  if(v.border){ctx.strokeStyle=theme.gold;ctx.lineWidth=2;ctx.strokeRect(W*.04,H*.04,W*.92,H*.92);ctx.strokeStyle=rgba(theme.gold,.3);ctx.lineWidth=.8;ctx.strokeRect(W*.055,H*.055,W*.89,H*.89);}
  if(v.flag)drawFlag(ctx,W*.05,H*.06,W*.12,W*.08);
  // Star burst behind number
  if(v.ornament){for(let i=0;i<24;i++){const a=i*Math.PI/12;const l=W*.18;ctx.save();ctx.globalAlpha=.15;ctx.strokeStyle=theme.gold2;ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(cx,H*.3);ctx.lineTo(cx+Math.cos(a)*l,H*.3+Math.sin(a)*l);ctx.stroke();ctx.restore();}}
  ctx.font=`900 ${W*.2}px 'Oswald',sans-serif`;ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillStyle=theme.gold2;ctx.fillText(v.angka,cx,H*.3);ctx.textBaseline='alphabetic';
  drawStar(ctx,cx,H*.3,W*.02,rgba(theme.red,.8));
  ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.white,.7);ctx.textAlign='center';ctx.letterSpacing='0.3em';ctx.fillText('HUT KE ‚Äî REPUBLIK INDONESIA',cx,H*.48);ctx.letterSpacing='0';
  ctx.font=`${W*.032}px 'Cinzel',serif`;ctx.fillStyle=theme.gold;ctx.textAlign='center';ctx.fillText(v.tahun,cx,H*.52);
  drawGLine(ctx,cx,H*.545,W*.38,theme.gold,2);
  if(photo)drawCirclePhoto(ctx,photo,cx,H*.64,W*.1,theme.gold);
  const ap=photo?H*.64+W*.1+W*.025:H*.56;
  if(v.showNama&&v.nama){ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=theme.white;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.022);}
  ctx.font=`${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.sub,.85);ctx.textAlign='center';
  fillWrapped(ctx,v.motto,cx,ap+W*.05,W*.72,W*.028);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.white,.65);ctx.textAlign='center';
  fillWrapped(ctx,v.pesan,cx,ap+W*.098,W*.7,W*.027);
  if(v.showSocial&&v.social){ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.gold,.65);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.962);}
}

// ‚îÄ‚îÄ T3: KLASIK NASIONAL ‚îÄ‚îÄ
function renderT3(ctx,W,H,theme,v,photo){
  drawBg(ctx,W,H,theme);const cx=W/2;
  if(v.flag){drawFlag(ctx,cx-W*.25,H*.04,W*.5,W*.33);
    // Flagpole
    ctx.fillStyle=rgba(theme.gold,.8);ctx.fillRect(cx-W*.252,H*.04,W*.005,W*.35);
  }
  if(v.border){ctx.strokeStyle=theme.gold;ctx.lineWidth=2.5;ctx.strokeRect(W*.04,W*.38+W*.005,W*.92,H-W*.38-W*.055);ctx.strokeStyle=rgba(theme.gold,.3);ctx.lineWidth=.8;ctx.strokeRect(W*.055,W*.38+W*.015,W*.89,H-W*.38-W*.07);}
  const y0=W*.38+W*.04;
  ctx.font=`900 ${W*.12}px 'Oswald',sans-serif`;ctx.fillStyle=theme.gold2;ctx.textAlign='center';ctx.fillText(v.angka+' TAHUN',cx,y0+W*.12);
  ctx.font=`700 ${W*.028}px 'Cinzel',serif`;ctx.fillStyle=theme.white;ctx.textAlign='center';ctx.fillText('DIRGAHAYU REPUBLIK INDONESIA',cx,y0+W*.16);
  ctx.font=`${W*.022}px 'Cinzel',serif`;ctx.fillStyle=theme.gold;ctx.textAlign='center';ctx.fillText(v.tahun,cx,y0+W*.195);
  drawGLine(ctx,cx,y0+W*.215,W*.35,theme.gold,2);
  if(photo)drawCirclePhoto(ctx,photo,cx,y0+W*.29,W*.085,theme.gold);
  const ap=photo?y0+W*.29+W*.085+W*.02:y0+W*.225;
  if(v.showNama&&v.nama){ctx.font=`bold ${W*.022}px 'EB Garamond',serif`;ctx.fillStyle=theme.white;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.02);}
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.sub,.85);ctx.textAlign='center';ctx.fillText('"'+v.motto+'"',cx,ap+W*.048);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.white,.68);ctx.textAlign='center';
  fillWrapped(ctx,v.pesan,cx,ap+W*.078,W*.7,W*.027);
  if(v.showSocial&&v.social){ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.gold,.65);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.962);}
}

// ‚îÄ‚îÄ T4: MODERN BOLD ‚îÄ‚îÄ
function renderT4(ctx,W,H,theme,v,photo){
  drawBg(ctx,W,H,theme);
  // Bold red left bar
  ctx.fillStyle=theme.red;ctx.fillRect(0,0,W*.08,H);
  // Gold accent top
  ctx.fillStyle=theme.gold;ctx.fillRect(W*.08,0,W,H*.008);
  // Ghost text
  ctx.font=`900 ${W*.5}px 'Oswald',sans-serif`;ctx.fillStyle=rgba(theme.red,.08);ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText(v.angka,W*.1,H*.45);ctx.textBaseline='alphabetic';
  if(v.flag)drawFlag(ctx,W*.1,H*.07,W*.15,W*.1);
  if(v.ornament)drawWings(ctx,W*.55,H*.28,W*.18,theme.gold,.4);
  const lx=W*.1;
  ctx.font=`900 ${W*.16}px 'Oswald',sans-serif`;ctx.fillStyle=theme.gold2;ctx.textAlign='left';ctx.fillText(v.angka,lx,H*.35);
  ctx.font=`700 ${W*.022}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.white,.8);ctx.textAlign='left';ctx.fillText('HUT KE ‚Äî REPUBLIK INDONESIA',lx,H*.41);
  ctx.font=`${W*.028}px 'Cinzel',serif`;ctx.fillStyle=theme.gold;ctx.textAlign='left';ctx.fillText(v.tahun,lx,H*.45);
  ctx.fillStyle=rgba(theme.gold,.4);ctx.fillRect(lx,H*.47,W*.5,2);
  ctx.font=`italic ${W*.02}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.white,.75);ctx.textAlign='left';ctx.fillText('"'+v.motto+'"',lx,H*.505);
  if(photo)drawCirclePhoto(ctx,photo,lx+W*.07,H*.63,W*.09,theme.gold);
  const px2=photo?lx+W*.18:lx;
  if(v.showNama&&v.nama){ctx.font=`bold ${W*.022}px 'EB Garamond',serif`;ctx.fillStyle=theme.white;ctx.textAlign='left';ctx.fillText(v.nama,px2,H*.596);}
  if(v.jabatan){ctx.font=`italic ${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.sub,.85);ctx.textAlign='left';ctx.fillText(v.jabatan,px2,H*.625);}
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgba(theme.white,.65);ctx.textAlign='left';
  fillWrapped(ctx,v.pesan,lx,H*.7,W*.82,W*.027);
  if(v.showSocial&&v.social){ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgba(theme.gold,.65);ctx.textAlign='left';ctx.fillText(v.social,lx,H*.96);}
}

const RENDERERS=[renderT0,renderT1,renderT2,renderT3,renderT4];
function doRenderToCanvas(cv){cv.width=S.cw;cv.height=S.ch;const ctx=cv.getContext('2d');(RENDERERS[S.template]||renderT0)(ctx,S.cw,S.ch,THEMES[S.theme],getVals(),S.photoImg);}
function doRender(){doRenderToCanvas(document.getElementById('mainCanvas'));renderAllMini();}
function doDownload(){const cv=document.getElementById('renderCanvas');doRenderToCanvas(cv);const a=document.createElement('a');a.download=`kemerdekaan-${Date.now()}.png`;a.href=cv.toDataURL('image/png',1);a.click();}
document.getElementById('mainCanvas').onclick=doDownload;
function renderMini(cv,tid){
  const W=100,H=75;cv.width=W;cv.height=H;const ctx=cv.getContext('2d');const t=THEMES[S.theme];
  const g=ctx.createLinearGradient(0,0,W,H);g.addColorStop(0,t.bg2);g.addColorStop(1,t.bg);ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  if(tid===1){ctx.fillStyle=t.red;ctx.fillRect(0,0,W,H/2);ctx.fillStyle='#f8f0e0';ctx.fillRect(0,H/2,W,H/2);}
  if(tid===4){ctx.fillStyle=t.red;ctx.fillRect(0,0,W*.08,H);}
  ctx.strokeStyle=t.gold;ctx.lineWidth=1.5;ctx.strokeRect(3,3,W-6,H-6);
  drawStar(ctx,W/2,H*.3,W*.12,rgba(t.gold,.7));
  ctx.font=`900 ${H*.28}px 'Oswald',sans-serif`;ctx.fillStyle=t.gold2;ctx.textAlign='center';ctx.fillText(document.getElementById('fAngka').value||'79',W/2,H*.62);
  ctx.font=`${H*.1}px 'Cinzel',serif`;ctx.fillStyle=rgba(t.white,.7);ctx.textAlign='center';ctx.fillText('HUT RI',W/2,H*.82);
}
function renderAllMini(){document.querySelectorAll('.tmpl-item canvas').forEach((cv,i)=>renderMini(cv,i));}
function initTemplates(){const grid=document.getElementById('tmplGrid');TMPL_NAMES.forEach((n,i)=>{const item=document.createElement('div');item.className='tmpl-item'+(i===0?' active':'');const cv=document.createElement('canvas');const lbl=document.createElement('div');lbl.className='lbl';lbl.textContent=n;item.appendChild(cv);item.appendChild(lbl);item.onclick=()=>{document.querySelectorAll('.tmpl-item').forEach(x=>x.classList.remove('active'));item.classList.add('active');S.template=i;doRender();};grid.appendChild(item);});}
function initColors(){const row=document.getElementById('colorRow');THEMES.forEach((t,i)=>{const d=document.createElement('div');d.className='cdot'+(i===0?' active':'');d.style.background=`linear-gradient(135deg,${t.bg} 40%,${t.red} 100%)`;d.style.borderColor=t.red;d.title=t.name;d.onclick=()=>{document.querySelectorAll('.cdot').forEach(x=>x.classList.remove('active'));d.classList.add('active');S.theme=i;doRender();};row.appendChild(d);});}
function initSizes(){document.querySelectorAll('.size-pill').forEach(btn=>{btn.onclick=()=>{document.querySelectorAll('.size-pill').forEach(x=>x.classList.remove('active'));btn.classList.add('active');S.cw=+btn.dataset.w;S.ch=+btn.dataset.h;doRender();};});}
function initLive(){['fAngka','fTahun','fNama','fJabatan','fMotto','fPesan','fSocial'].forEach(id=>document.getElementById(id).addEventListener('input',doRender));['tOrnament','tFlag','tBorder','tNama','tSocial'].forEach(id=>document.getElementById(id).addEventListener('change',doRender));}
document.getElementById('photoInput').onchange=function(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const img=new Image();img.onload=()=>{S.photoImg=img;document.getElementById('photoThumb').src=ev.target.result;document.getElementById('photoThumb').style.display='block';doRender();};img.src=ev.target.result;};r.readAsDataURL(f);};
initTemplates();initColors();initSizes();initLive();
document.fonts.ready.then(()=>{renderAllMini();doRender();});setTimeout(()=>{renderAllMini();doRender();},600);
</script>
</body>
</html>
