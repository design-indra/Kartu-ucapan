<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kartu Ucapan Aqiqah ‚Äî Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0c0814;--panel:#130d1c;--bdr:rgba(200,150,240,.15);
  --purple:#b57bee;--pink:#f472b6;--gold:#f0c060;--gold2:#fde68a;
  --white:#fdf8ff;--ash:#9080a8;--card-w:500px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:var(--bg);
  background-image:
    radial-gradient(ellipse at 15% 0%,rgba(120,50,180,.3) 0%,transparent 50%),
    radial-gradient(ellipse at 85% 100%,rgba(180,80,140,.2) 0%,transparent 50%);
  color:var(--white);font-family:'EB Garamond',serif;min-height:100vh;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.site-header{
  text-align:center;padding:2rem 1rem 1.5rem;
  border-bottom:1px solid var(--bdr);
  background:rgba(0,0,0,.3);backdrop-filter:blur(8px);
  position:sticky;top:0;z-index:100;
}
.site-header .sub{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.3em;color:var(--pink);display:block;margin-bottom:.3rem;}
.site-header h1{font-family:'Cinzel',serif;font-size:clamp(1.1rem,3vw,1.75rem);font-weight:400;color:var(--gold2);letter-spacing:.08em;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.workspace{display:flex;min-height:calc(100vh - 78px);}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{
  width:300px;min-width:268px;max-width:300px;
  background:var(--panel);border-right:1px solid var(--bdr);
  padding:1.3rem;overflow-y:auto;max-height:calc(100vh - 78px);
  position:sticky;top:78px;
}
.sidebar::-webkit-scrollbar{width:3px;}
.sidebar::-webkit-scrollbar-thumb{background:rgba(180,120,220,.3);border-radius:4px;}

.s-sec{margin-bottom:1.25rem;}
.s-title{
  font-family:'Cinzel',serif;font-size:.57rem;letter-spacing:.22em;
  color:var(--purple);display:flex;align-items:center;gap:.6rem;margin-bottom:.75rem;
}
.s-title::after{content:'';flex:1;height:1px;background:var(--bdr);}

.field{margin-bottom:.75rem;}
.field label{display:block;font-size:.78rem;color:var(--ash);margin-bottom:.25rem;}
.field input,.field textarea,.field select{
  width:100%;background:rgba(255,255,255,.05);border:1px solid var(--bdr);
  color:var(--white);font-family:'EB Garamond',serif;font-size:.93rem;
  padding:.48rem .72rem;border-radius:3px;outline:none;transition:border-color .25s;
}
.field input:focus,.field textarea:focus{border-color:rgba(180,120,220,.5);}
.field textarea{resize:vertical;min-height:75px;line-height:1.55;}
.field select option{background:#130d1c;}

/* Upload */
.upload-zone{
  border:2px dashed rgba(180,120,220,.28);border-radius:5px;
  padding:1rem;text-align:center;cursor:pointer;transition:all .3s;position:relative;
}
.upload-zone:hover{border-color:var(--purple);background:rgba(180,120,220,.07);}
.upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.upload-zone .icon{font-size:1.5rem;margin-bottom:.3rem;}
.upload-zone p{font-size:.75rem;color:var(--ash);}
.upload-zone p strong{color:var(--purple);display:block;font-size:.8rem;}
.thumb{width:60px;height:60px;border-radius:50%;object-fit:cover;border:2px solid var(--purple);margin:.5rem auto 0;display:none;}

/* Template grid */
.tmpl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.4rem;}
.tmpl-item{
  border:2px solid var(--bdr);border-radius:4px;cursor:pointer;
  overflow:hidden;aspect-ratio:3/4;background:#0c0814;
  transition:border-color .25s,transform .2s;position:relative;
}
.tmpl-item:hover{border-color:rgba(180,120,220,.7);transform:scale(1.04);}
.tmpl-item.active{border-color:var(--purple);}
.tmpl-item canvas{width:100%;height:100%;display:block;}
.tmpl-item .lbl{
  position:absolute;bottom:0;left:0;right:0;
  background:rgba(0,0,0,.72);font-family:'Cinzel',serif;
  font-size:.4rem;letter-spacing:.06em;color:var(--gold2);
  text-align:center;padding:2px 0;
}

/* Toggle */
.trow{display:flex;align-items:center;justify-content:space-between;margin-bottom:.42rem;}
.trow>span{font-size:.78rem;color:var(--ash);}
.sw{position:relative;width:36px;height:19px;cursor:pointer;}
.sw input{display:none;}
.sw-t{position:absolute;inset:0;background:rgba(255,255,255,.08);border-radius:20px;border:1px solid var(--bdr);transition:background .3s;}
.sw-t::after{content:'';position:absolute;top:2px;left:2px;width:13px;height:13px;background:var(--ash);border-radius:50%;transition:transform .3s,background .3s;}
.sw input:checked+.sw-t{background:rgba(180,120,220,.2);}
.sw input:checked+.sw-t::after{transform:translateX(17px);background:var(--purple);}

/* Colors */
.crows{display:flex;gap:.38rem;flex-wrap:wrap;}
.cdot{width:23px;height:23px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;}
.cdot:hover,.cdot.active{border-color:var(--gold);transform:scale(1.2);}

/* Sizes */
.spills{display:flex;gap:.35rem;flex-wrap:wrap;}
.spill{
  padding:.28rem .65rem;border:1px solid var(--bdr);border-radius:20px;
  font-family:'Cinzel',serif;font-size:.56rem;letter-spacing:.07em;
  color:var(--ash);cursor:pointer;transition:all .25s;background:none;
}
.spill:hover,.spill.active{border-color:var(--purple);color:var(--purple);background:rgba(180,120,220,.08);}

/* Buttons */
.btn-dl{
  width:100%;padding:.75rem;margin-top:.5rem;
  background:linear-gradient(135deg,#6b1080,var(--purple),#6b1080);
  background-size:200%;border:none;color:#fff0ff;
  font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.14em;
  cursor:pointer;border-radius:3px;transition:background-position .4s,transform .2s;
}
.btn-dl:hover{background-position:100%;transform:translateY(-1px);}
.btn-ref{
  width:100%;padding:.62rem;margin-top:.38rem;
  background:transparent;border:1px solid rgba(180,120,220,.35);
  color:var(--gold2);font-family:'Cinzel',serif;font-size:.66rem;
  letter-spacing:.1em;cursor:pointer;border-radius:3px;transition:all .3s;
}
.btn-ref:hover{background:rgba(180,120,220,.1);}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main-area{
  flex:1;display:flex;flex-direction:column;
  align-items:center;padding:2rem 1.5rem 4rem;gap:.8rem;overflow-y:auto;
}
.clabel{font-family:'Cinzel',serif;font-size:.56rem;letter-spacing:.22em;color:var(--ash);text-align:center;}
#mainCanvas{
  width:min(var(--card-w),90vw);
  box-shadow:0 20px 80px rgba(0,0,0,.8),0 0 0 1px rgba(180,120,220,.18),0 0 60px rgba(120,50,180,.1);
  border-radius:4px;display:block;cursor:pointer;transition:box-shadow .3s;
}
#mainCanvas:hover{box-shadow:0 24px 90px rgba(0,0,0,.85),0 0 0 1px rgba(180,120,220,.55),0 0 80px rgba(120,50,180,.18);}
.chint{font-size:.74rem;font-style:italic;color:var(--ash);text-align:center;}

@media(max-width:720px){
  .workspace{flex-direction:column;}
  .sidebar{width:100%;max-width:100%;max-height:none;position:static;border-right:none;border-bottom:1px solid var(--bdr);}
  :root{--card-w:calc(100vw - 2rem);}
}
</style>
</head>
<body>

<div class="site-header">
  <span class="sub">üå∏ SYUKURAN KELAHIRAN üå∏</span>
  <h1>Pembuat Kartu Ucapan Aqiqah</h1>
</div>

<div class="workspace">
<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<aside class="sidebar">

  <div class="s-sec">
    <div class="s-title">Foto Bayi</div>
    <div class="upload-zone">
      <input type="file" accept="image/*" id="photoInput">
      <div class="icon">üë∂</div>
      <p><strong>Upload Foto Bayi</strong>JPG ¬∑ PNG ¬∑ WEBP</p>
    </div>
    <img class="thumb" id="photoThumb">
  </div>

  <div class="s-sec">
    <div class="s-title">Logo Instansi</div>
    <div class="upload-zone">
      <input type="file" accept="image/*" id="logoInput">
      <div class="icon">üèõÔ∏è</div>
      <p><strong>Upload Logo</strong>PNG transparan</p>
    </div>
    <img class="thumb" id="logoThumb">
  </div>

  <div class="s-sec">
    <div class="s-title">Pilih Template</div>
    <div class="tmpl-grid" id="tmplGrid"></div>
  </div>

  <div class="s-sec">
    <div class="s-title">Ukuran Kartu</div>
    <div class="spills">
      <button class="spill active" data-w="1080" data-h="1080">1:1 Post</button>
      <button class="spill" data-w="1080" data-h="1920">9:16 Story</button>
      <button class="spill" data-w="1080" data-h="1350">4:5 Feed</button>
    </div>
  </div>

  <div class="s-sec">
    <div class="s-title">Informasi Bayi</div>
    <div class="field"><label>Nama Bayi</label>
      <input type="text" id="fNama" value="Muhammad Fauzan Al-Fatih"></div>
    <div class="field"><label>Jenis Kelamin</label>
      <select id="fJK">
        <option value="putra">Putra üë¶</option>
        <option value="putri">Putri üëß</option>
      </select>
    </div>
    <div class="field"><label>Tanggal Lahir</label>
      <input type="text" id="fTglLahir" value="Senin, 12 Agustus 2024"></div>
    <div class="field"><label>Berat / Panjang Lahir</label>
      <input type="text" id="fBerat" value="3,2 kg / 50 cm"></div>
    <div class="field"><label>Tanggal Aqiqah</label>
      <input type="text" id="fTglAqiqah" value="Ahad, 25 Agustus 2024"></div>
    <div class="field"><label>Anak Ke-</label>
      <input type="text" id="fAnakKe" value="Anak Pertama"></div>
  </div>

  <div class="s-sec">
    <div class="s-title">Data Orang Tua</div>
    <div class="field"><label>Nama Ayah</label>
      <input type="text" id="fAyah" value="Ahmad Fauzi, S.T."></div>
    <div class="field"><label>Nama Ibu</label>
      <input type="text" id="fIbu" value="Siti Rahayu, S.Pd."></div>
    <div class="field"><label>Alamat / Kota</label>
      <input type="text" id="fKota" value="Jakarta Selatan"></div>
  </div>

  <div class="s-sec">
    <div class="s-title">Teks & Doa</div>
    <div class="field"><label>Kaligrafi Arab</label>
      <input type="text" id="fAyat" value="ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê"></div>
    <div class="field"><label>Judul Kartu</label>
      <input type="text" id="fJudul" value="Syukuran Aqiqah"></div>
    <div class="field"><label>Doa & Harapan</label>
      <textarea id="fPesan">Semoga menjadi anak yang sholeh/sholehah, berbakti kepada kedua orang tua, dan berguna bagi agama, nusa, dan bangsa. Aamiin Ya Rabbal Alamin.</textarea></div>
    <div class="field"><label>Sosmed / Website</label>
      <input type="text" id="fSocial" value=""></div>
  </div>

  <div class="s-sec">
    <div class="s-title">Warna Tema</div>
    <div class="crows" id="colorRow"></div>
  </div>

  <div class="s-sec">
    <div class="s-title">Elemen</div>
    <div class="trow"><span>Ornamen Bunga</span>
      <label class="sw"><input type="checkbox" id="tFlower" checked><span class="sw-t"></span></label></div>
    <div class="trow"><span>Bintang / Sparkle</span>
      <label class="sw"><input type="checkbox" id="tStar" checked><span class="sw-t"></span></label></div>
    <div class="trow"><span>Bingkai / Border</span>
      <label class="sw"><input type="checkbox" id="tBorder" checked><span class="sw-t"></span></label></div>
    <div class="trow"><span>Teks Arab</span>
      <label class="sw"><input type="checkbox" id="tAyat" checked><span class="sw-t"></span></label></div>
    <div class="trow"><span>Data BB / PB</span>
      <label class="sw"><input type="checkbox" id="tBerat" checked><span class="sw-t"></span></label></div>
    <div class="trow"><span>Kota / Alamat</span>
      <label class="sw"><input type="checkbox" id="tKota" checked><span class="sw-t"></span></label></div>
  </div>

  <button class="btn-dl" onclick="doDownload()">‚¨á UNDUH KARTU PNG</button>
  <button class="btn-ref" onclick="doRender()">‚Üª PERBARUI PRATINJAU</button>

</aside>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<main class="main-area">
  <div class="clabel">‚ú¶ PRATINJAU KARTU ‚ú¶</div>
  <canvas id="mainCanvas" width="1080" height="1080"></canvas>
  <p class="chint">Klik kartu untuk mengunduh ¬∑ Resolusi tinggi siap cetak &amp; share</p>
</main>
</div>

<canvas id="renderCanvas" width="1080" height="1080" style="display:none"></canvas>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S={template:0,theme:0,cw:1080,ch:1080,photoImg:null,logoImg:null};

const THEMES=[
  {n:'Ungu Lembut', bg:'#1a0d28',bg2:'#240f36',a:'#c084fc',a2:'#ede9fe',g:'#f0c060',g2:'#fde68a',ink:'#fdf8ff',sub:'#d8b4fe',rb:'#7c3aed'},
  {n:'Pink Mawar',  bg:'#1e0818',bg2:'#2c0c24',a:'#f472b6',a2:'#fce7f3',g:'#f0c060',g2:'#fde68a',ink:'#fff0f8',sub:'#f9a8d4',rb:'#be185d'},
  {n:'Mint Segar',  bg:'#061a10',bg2:'#082818',a:'#34d399',a2:'#d1fae5',g:'#f0c060',g2:'#fde68a',ink:'#f0fff8',sub:'#6ee7b7',rb:'#059669'},
  {n:'Biru Langit', bg:'#060c1e',bg2:'#0a122e',a:'#60a5fa',a2:'#dbeafe',g:'#f0c060',g2:'#fde68a',ink:'#f0f8ff',sub:'#93c5fd',rb:'#1d4ed8'},
  {n:'Kuning Madu', bg:'#1a1400',bg2:'#261e04',a:'#fbbf24',a2:'#fef3c7',g:'#f0c060',g2:'#fde68a',ink:'#fffbeb',sub:'#fde68a',rb:'#b45309'},
  {n:'Rose Emas',   bg:'#1e0c14',bg2:'#2a1020',a:'#e07898',a2:'#fde8f0',g:'#e8b870',g2:'#fde68a',ink:'#fff0f5',sub:'#f0a8c0',rb:'#be185d'},
];

const TMPL_NAMES=['Bunga Pastel','Islami Mewah','Modern Card','Minimalis','Bunting Pesta','Oval Elegan'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function rgb(h,a){const r=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),b=parseInt(h.slice(5,7),16);return`rgba(${r},${g},${b},${a})`;}
function wrap(ctx,txt,maxW){const ws=txt.split(' ');const ls=[];let c='';ws.forEach(w=>{const t=c?c+' '+w:w;if(ctx.measureText(t).width>maxW&&c){ls.push(c);c=w;}else c=t;});if(c)ls.push(c);return ls;}
function fillW(ctx,txt,x,y,maxW,lh,align='center'){ctx.textAlign=align;const ls=wrap(ctx,txt,maxW);ls.forEach((l,i)=>ctx.fillText(l,x,y+i*lh));return ls.length*lh;}
function gline(ctx,cx,y,hw,col,lw=1.5){const g=ctx.createLinearGradient(cx-hw,y,cx+hw,y);g.addColorStop(0,'transparent');g.addColorStop(.35,col);g.addColorStop(.65,col);g.addColorStop(1,'transparent');ctx.save();ctx.strokeStyle=g;ctx.lineWidth=lw;ctx.beginPath();ctx.moveTo(cx-hw,y);ctx.lineTo(cx+hw,y);ctx.stroke();ctx.restore();}

// Draw noise texture
function noise(ctx,W,H,a=8){const id=ctx.createImageData(W,H);for(let i=0;i<id.data.length;i+=4){const v=Math.random()*255;id.data[i]=v;id.data[i+1]=v;id.data[i+2]=v;id.data[i+3]=a;}ctx.putImageData(id,0,0);}

// Draw bg with gradient
function bg(ctx,W,H,t){
  const g=ctx.createLinearGradient(0,0,W,H);g.addColorStop(0,t.bg2);g.addColorStop(1,t.bg);ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  const rg=ctx.createRadialGradient(W*.5,H*.3,0,W*.5,H*.3,W*.65);rg.addColorStop(0,rgb(t.a,.1));rg.addColorStop(1,'transparent');ctx.fillStyle=rg;ctx.fillRect(0,0,W,H);
  noise(ctx,W,H,6);
}

// Photo circle
function photoCircle(ctx,photo,cx,cy,r,col,bw=6){
  ctx.save();
  ctx.shadowColor='rgba(0,0,0,.5)';ctx.shadowBlur=24;ctx.shadowOffsetY=7;
  ctx.beginPath();ctx.arc(cx,cy,r+bw+3,0,Math.PI*2);ctx.fillStyle=col;ctx.fill();
  ctx.shadowColor='transparent';
  ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.clip();
  if(photo){const sc=Math.max(r*2/photo.width,r*2/photo.height);ctx.drawImage(photo,cx-photo.width*sc/2,cy-photo.height*sc/2,photo.width*sc,photo.height*sc);}
  else{ctx.fillStyle=rgb(col,.12);ctx.fill();ctx.font=`${r*.52}px serif`;ctx.fillStyle=rgb('#fff',.28);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('üë∂',cx,cy);ctx.textBaseline='alphabetic';}
  ctx.restore();
}

// 5-point star
function star5(ctx,cx,cy,r,col,a=1){ctx.save();ctx.globalAlpha*=a;ctx.fillStyle=col;ctx.beginPath();for(let i=0;i<10;i++){const ang=i*Math.PI/5-Math.PI/2;const rd=i%2===0?r:r*.4;i===0?ctx.moveTo(cx+Math.cos(ang)*rd,cy+Math.sin(ang)*rd):ctx.lineTo(cx+Math.cos(ang)*rd,cy+Math.sin(ang)*rd);}ctx.closePath();ctx.fill();ctx.restore();}

// Petal flower
function flower(ctx,cx,cy,size,col,alpha=1){
  ctx.save();ctx.globalAlpha*=alpha;
  for(let i=0;i<6;i++){const a=i*Math.PI/3;ctx.beginPath();ctx.ellipse(cx+Math.cos(a)*size*.52,cy+Math.sin(a)*size*.52,size*.42,size*.26,a,0,Math.PI*2);ctx.fillStyle=col;ctx.fill();}
  ctx.beginPath();ctx.arc(cx,cy,size*.22,0,Math.PI*2);const cg=ctx.createRadialGradient(cx,cy,0,cx,cy,size*.22);cg.addColorStop(0,rgb(col,1.2));cg.addColorStop(1,rgb(col,.7));ctx.fillStyle=cg;ctx.fill();
  ctx.restore();
}

// Small blossom
function blossom(ctx,cx,cy,r,col,alpha=1){
  ctx.save();ctx.globalAlpha*=alpha;
  for(let i=0;i<5;i++){const a=i*Math.PI*2/5;ctx.beginPath();ctx.ellipse(cx+Math.cos(a)*r*.48,cy+Math.sin(a)*r*.48,r*.42,r*.28,a,0,Math.PI*2);ctx.fillStyle=col;ctx.fill();}
  ctx.beginPath();ctx.arc(cx,cy,r*.2,0,Math.PI*2);ctx.fillStyle=rgb(col,.9);ctx.fill();
  ctx.restore();
}

// Leaf
function leaf(ctx,cx,cy,size,angle,hue=35,alpha=.65){
  ctx.save();ctx.globalAlpha*=alpha;ctx.translate(cx,cy);ctx.rotate(angle);
  ctx.beginPath();ctx.moveTo(0,0);ctx.bezierCurveTo(-size*.28,-size*.48,-size*.38,-size*.88,0,-size);ctx.bezierCurveTo(size*.38,-size*.88,size*.28,-size*.48,0,0);
  const lg=ctx.createLinearGradient(0,0,0,-size);lg.addColorStop(0,`hsla(${hue},50%,45%,.85)`);lg.addColorStop(1,`hsla(${hue+15},45%,60%,.5)`);ctx.fillStyle=lg;ctx.fill();
  ctx.restore();
}

// Corner flower cluster
function cornerFlowers(ctx,x,y,sz,t,position){
  ctx.save();ctx.translate(x,y);
  const flip={tr:[1,1],bl:[-1,-1],tl:[-1,1],br:[1,-1]}[position]||[1,1];
  ctx.scale(flip[0],flip[1]);
  // leaves
  leaf(ctx,sz*.05,sz*.05,sz*.58,-0.28,34,.6);
  leaf(ctx,sz*.22,-sz*.05,sz*.5,-0.75,40,.55);
  leaf(ctx,-sz*.08,sz*.15,sz*.44,0.38,32,.48);
  leaf(ctx,sz*.38,sz*.12,sz*.52,-1.08,42,.58);
  leaf(ctx,sz*.56,-sz*.04,sz*.38,-1.48,38,.48);
  // blossoms
  blossom(ctx,sz*.08,sz*.38,sz*.22,t.a,.5);
  blossom(ctx,sz*.5,sz*.06,sz*.18,rgb(t.g,1),.6);
  blossom(ctx,sz*.42,sz*.32,sz*.17,t.a2,.55);
  blossom(ctx,sz*.66,sz*.22,sz*.12,t.a,.55);
  // main flowers
  flower(ctx,sz*.28,sz*.2,sz*.32,t.a,.9);
  flower(ctx,sz*.06,sz*.12,sz*.18,rgb(t.g,1),.7);
  ctx.restore();
}

// Sparkles / star field
function sparkles(ctx,W,H,col1,col2,count=35){
  for(let i=0;i<count;i++){
    const x=Math.random()*W,y=Math.random()*H,s=Math.random()*2.2+.5;
    ctx.save();ctx.globalAlpha=Math.random()*.5+.08;ctx.fillStyle=i%3===0?col1:col2;ctx.beginPath();ctx.arc(x,y,s,0,Math.PI*2);ctx.fill();ctx.restore();
  }
}

// Info card rounded rect
function infoCard(ctx,x,y,w,h,fillColor,strokeColor){
  ctx.fillStyle=fillColor;ctx.beginPath();ctx.roundRect(x,y,w,h,8);ctx.fill();
  ctx.strokeStyle=strokeColor;ctx.lineWidth=1;ctx.stroke();
}

// Bunting flag
function buntingFlag(ctx,x,y,w,h,col){
  ctx.fillStyle=col;ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(x+w,y);ctx.lineTo(x+w/2,y+h);ctx.closePath();ctx.fill();
  ctx.strokeStyle='rgba(255,255,255,.25)';ctx.lineWidth=.6;ctx.stroke();
}

function getVals(){
  return{
    nama:   document.getElementById('fNama').value,
    jk:     document.getElementById('fJK').value,
    tgll:   document.getElementById('fTglLahir').value,
    berat:  document.getElementById('fBerat').value,
    tgla:   document.getElementById('fTglAqiqah').value,
    anakke: document.getElementById('fAnakKe').value,
    ayah:   document.getElementById('fAyah').value,
    ibu:    document.getElementById('fIbu').value,
    kota:   document.getElementById('fKota').value,
    ayat:   document.getElementById('fAyat').value,
    judul:  document.getElementById('fJudul').value,
    pesan:  document.getElementById('fPesan').value,
    social: document.getElementById('fSocial').value,
    flower: document.getElementById('tFlower').checked,
    star:   document.getElementById('tStar').checked,
    border: document.getElementById('tBorder').checked,
    showAyat: document.getElementById('tAyat').checked,
    showBerat: document.getElementById('tBerat').checked,
    showKota: document.getElementById('tKota').checked,
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TEMPLATES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ T0: BUNGA PASTEL ‚îÄ‚îÄ
function t0(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);
  const cx=W/2;
  if(v.star) sparkles(ctx,W,H,t.g2,t.a2,40);
  const pad=W*.05;
  if(v.flower){
    cornerFlowers(ctx,W-pad,pad,W*.22,t,'tr');
    cornerFlowers(ctx,pad,H-pad,W*.22,t,'bl');
  }
  if(v.border){
    ctx.strokeStyle=rgb(t.a,.45);ctx.lineWidth=1.8;ctx.strokeRect(pad,pad,W-pad*2,H-pad*2);
    ctx.strokeStyle=rgb(t.g,.28);ctx.lineWidth=.8;ctx.strokeRect(pad+9,pad+9,W-pad*2-18,H-pad*2-18);
  }
  let y=pad+H*.055;
  if(logo&&v.showAyat){ctx.drawImage(logo,cx-W*.04,y,W*.08,W*.08);y+=W*.1;}
  if(v.showAyat){ctx.font=`${W*.036}px 'Amiri',serif`;ctx.fillStyle=rgb(t.a,.92);ctx.textAlign='center';ctx.fillText(v.ayat,cx,y+W*.038);y+=W*.062;}
  ctx.font=`italic ${W*.054}px 'Great Vibes',cursive`;ctx.fillStyle=t.g2;ctx.textAlign='center';ctx.fillText(v.judul,cx,y+W*.058);y+=W*.073;
  gline(ctx,cx,y,W*.32,t.a,1.8);y+=W*.03;
  // gender emoji
  const emoji=v.jk==='putri'?'üëß':'üë¶';
  const photoR=W*.135;const photoY=y+photoR+W*.018;
  photoCircle(ctx,photo,cx,photoY,photoR,t.a,7);
  if(v.star) for(let i=0;i<8;i++){const a=(i/8)*Math.PI*2;star5(ctx,cx+Math.cos(a)*(photoR+W*.052),photoY+Math.sin(a)*(photoR+W*.052),W*.013,t.g2,.55);}
  const ap=photoY+photoR;
  ctx.font=`${W*.03}px serif`;ctx.fillStyle=t.a2;ctx.textAlign='center';ctx.fillText(emoji,cx,ap+W*.04);
  ctx.font=`italic ${W*.058}px 'Great Vibes',cursive`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.085);
  ctx.font=`italic ${W*.02}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.85);ctx.textAlign='center';ctx.fillText(v.anakke,cx,ap+W*.11);
  // info row
  const infoY=ap+W*.128;const infoH=W*.165;
  infoCard(ctx,cx-W*.35,infoY,W*.7,infoH,rgb(t.a,.08),rgb(t.a,.3));
  ctx.font=`${W*.016}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.g,.85);
  const rows=[['üóì Lahir',v.tgll],['üïå Aqiqah',v.tgla]];
  if(v.showBerat) rows.splice(1,0,['‚öñÔ∏è BB/PB',v.berat]);
  rows.forEach(([k,val],i)=>{
    ctx.textAlign='left';ctx.fillStyle=rgb(t.g,.8);ctx.fillText(k,cx-W*.32,infoY+W*.038+i*W*.048);
    ctx.fillStyle=t.ink;ctx.fillText(val,cx-W*.1,infoY+W*.038+i*W*.048);
  });
  const by=infoY+infoH+W*.02;
  gline(ctx,cx,by,W*.3,t.a);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.8);ctx.textAlign='center';ctx.fillText('Putra/Putri dari',cx,by+W*.03);
  ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,by+W*.06);
  if(v.showKota&&v.kota){ctx.font=`${W*.017}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.7);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,by+W*.085);}
  gline(ctx,cx,by+W*.1,W*.28,t.a);
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.65);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,by+W*.125,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.55);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.97);}
}

// ‚îÄ‚îÄ T1: ISLAMI MEWAH ‚îÄ‚îÄ
function t1(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);const cx=W/2;
  if(v.star) sparkles(ctx,W,H,t.g2,t.a2,30);
  const pad=W*.04;
  if(v.border){ctx.strokeStyle=t.g;ctx.lineWidth=2.5;ctx.strokeRect(pad,pad,W-pad*2,H-pad*2);ctx.strokeStyle=rgb(t.g,.3);ctx.lineWidth=.8;ctx.strokeRect(pad+12,pad+12,W-pad*2-24,H-pad*2-24);}
  // gold corner brackets
  [[pad,pad,0],[W-pad,pad,90],[W-pad,H-pad,180],[pad,H-pad,270]].forEach(([x,y,r])=>{
    ctx.save();ctx.translate(x,y);ctx.rotate(r*Math.PI/180);
    ctx.strokeStyle=t.g;ctx.lineWidth=2.2;ctx.beginPath();ctx.moveTo(0,W*.065);ctx.lineTo(0,0);ctx.lineTo(W*.065,0);ctx.stroke();
    ctx.fillStyle=t.g;ctx.beginPath();ctx.arc(W*.015,W*.015,2.5,0,Math.PI*2);ctx.fill();
    ctx.restore();
  });
  if(v.flower){
    cornerFlowers(ctx,W-pad,pad,W*.18,t,'tr');
    cornerFlowers(ctx,pad,H-pad,W*.18,t,'bl');
  }
  let y=pad+H*.062;
  if(logo){ctx.drawImage(logo,cx-W*.045,y,W*.09,W*.09);y+=W*.12;}
  if(v.showAyat){ctx.font=`${W*.04}px 'Amiri',serif`;ctx.fillStyle=rgb(t.g,.92);ctx.textAlign='center';ctx.fillText(v.ayat,cx,y+W*.043);y+=W*.068;}
  gline(ctx,cx,y,W*.35,t.g,2);y+=W*.025;
  ctx.font=`700 ${W*.048}px 'Playfair Display',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.judul,cx,y+W*.052);y+=W*.068;
  ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.75);ctx.textAlign='center';ctx.letterSpacing='0.22em';ctx.fillText('‚Äî SYUKURAN KELAHIRAN BUAH HATI ‚Äî',cx,y+W*.01);ctx.letterSpacing='0';y+=W*.038;
  gline(ctx,cx,y,W*.28,t.g);y+=W*.025;
  const photoR=W*.13;const photoY=y+photoR+W*.015;
  // decorative ring
  if(v.flower){for(let i=0;i<8;i++){const a=(i/8)*Math.PI*2;blossom(ctx,cx+Math.cos(a)*(photoR+W*.06),photoY+Math.sin(a)*(photoR+W*.06),W*.028,i%2===0?t.a:t.g,.65);}}
  photoCircle(ctx,photo,cx,photoY,photoR,t.g,8);
  const ap=photoY+photoR;
  ctx.font=`italic ${W*.062}px 'Great Vibes',cursive`;ctx.fillStyle=t.g2;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.075);
  ctx.font=`${W*.02}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.9);ctx.textAlign='center';ctx.fillText(v.anakke+' ¬∑ '+v.tgll,cx,ap+W*.105);
  if(v.showBerat){ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.8);ctx.textAlign='center';ctx.fillText(v.berat,cx,ap+W*.128);}
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.a,.9);ctx.textAlign='center';ctx.fillText('Aqiqah: '+v.tgla,cx,ap+W*.152);
  gline(ctx,cx,ap+W*.172,W*.35,t.g,1.5);
  ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,ap+W*.208);
  if(v.showKota&&v.kota){ctx.font=`${W*.017}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.7);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,ap+W*.232);}
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.65);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,ap+W*.26,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.5);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.972);}
}

// ‚îÄ‚îÄ T2: MODERN CARD ‚îÄ‚îÄ
function t2(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);const cx=W/2;
  // Ribbon header
  const rh=H*.115;
  const rg=ctx.createLinearGradient(0,0,W,rh);rg.addColorStop(0,rgb(t.rb,.95));rg.addColorStop(1,rgb(t.rb,.75));
  ctx.fillStyle=rg;ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(W,0);ctx.lineTo(W,rh);ctx.lineTo(cx,rh*1.28);ctx.lineTo(0,rh);ctx.closePath();ctx.fill();
  // Stars on ribbon
  if(v.star)[[W*.08,rh*.5],[W*.92,rh*.5],[W*.25,rh*.35],[W*.75,rh*.35]].forEach(([x,y])=>star5(ctx,x,y,W*.02,rgb(t.g2,1),.75));
  ctx.font=`800 ${W*.035}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.ink,.95);ctx.textAlign='center';ctx.fillText('‚ú¶  '+v.judul.toUpperCase()+'  ‚ú¶',cx,rh*.65);
  if(v.star) sparkles(ctx,W,H*.85,t.g2,t.a2,25);
  if(v.flower){cornerFlowers(ctx,W,rh,W*.18,t,'br');cornerFlowers(ctx,0,H,W*.18,t,'tl');}
  if(v.border){ctx.strokeStyle=rgb(t.a,.4);ctx.lineWidth=1.5;ctx.strokeRect(W*.04,rh+W*.025,W*.92,H-rh-W*.045);}
  const photoR=W*.14;const photoY=rh+photoR+W*.06;
  // glow ring
  const pg=ctx.createRadialGradient(cx,photoY,photoR*.5,cx,photoY,photoR*1.9);pg.addColorStop(0,rgb(t.a,.18));pg.addColorStop(1,'transparent');ctx.fillStyle=pg;ctx.beginPath();ctx.arc(cx,photoY,photoR*1.9,0,Math.PI*2);ctx.fill();
  photoCircle(ctx,photo,cx,photoY,photoR,t.a,8);
  if(v.flower){flower(ctx,cx-photoR-W*.07,photoY,W*.05,t.a,.7);flower(ctx,cx+photoR+W*.07,photoY,W*.05,rgb(t.g,1),.7);}
  const ap=photoY+photoR;
  const emoji=v.jk==='putri'?'üëß':'üë¶';
  ctx.font=`${W*.028}px serif`;ctx.fillStyle=t.a2;ctx.textAlign='center';ctx.fillText(emoji,cx,ap+W*.04);
  ctx.font=`italic ${W*.06}px 'Great Vibes',cursive`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.085);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.85);ctx.textAlign='center';ctx.fillText(v.anakke,cx,ap+W*.11);
  // Data cards row
  const cardsY=ap+W*.13;const cw=W*.28,ch=W*.1;const cx1=cx-W*.3,cx2=cx,cx3=cx+W*.3;
  [[cx1,'üóì',v.tgll,'Lahir'],[cx2,'‚öñÔ∏è',v.berat,'BB/PB'],[cx3,'üïå',v.tgla,'Aqiqah']].forEach(([bx,ic,val,lbl])=>{
    if(!val&&lbl==='BB/PB'&&!v.showBerat)return;
    infoCard(ctx,bx-cw/2,cardsY,cw,ch,rgb(t.a,.1),rgb(t.a,.3));
    ctx.font=`${W*.012}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.g,.8);ctx.textAlign='center';ctx.fillText(ic+' '+lbl,bx,cardsY+W*.033);
    ctx.font=`${W*.015}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';
    const ls=wrap(ctx,val,cw*.85);ls.forEach((l,i)=>ctx.fillText(l,bx,cardsY+W*.058+i*W*.022));
  });
  const by=cardsY+ch+W*.025;
  gline(ctx,cx,by,W*.32,t.a,1.5);
  ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,by+W*.038);
  if(v.showKota&&v.kota){ctx.font=`${W*.017}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.7);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,by+W*.062);}
  gline(ctx,cx,by+W*.08,W*.28,t.a);
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.65);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,by+W*.105,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.5);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.972);}
}

// ‚îÄ‚îÄ T3: MINIMALIS ‚îÄ‚îÄ
function t3(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);const cx=W/2;
  if(v.star) sparkles(ctx,W,H,t.g2,t.a2,20);
  ctx.fillStyle=t.a;ctx.fillRect(0,0,W,H*.006);ctx.fillRect(0,H-H*.006,W,H*.006);
  if(v.border){ctx.strokeStyle=rgb(t.a,.35);ctx.lineWidth=1.2;ctx.strokeRect(W*.05,H*.04,W*.9,H*.92);}
  if(v.flower){flower(ctx,W*.08,H*.1,W*.06,t.a,.55);flower(ctx,W*.92,H*.1,W*.06,rgb(t.g,.8),.55);flower(ctx,W*.08,H*.9,W*.06,rgb(t.g,.8),.5);flower(ctx,W*.92,H*.9,W*.06,t.a,.5);}
  let y=H*.085;
  if(v.showAyat){ctx.font=`${W*.036}px 'Amiri',serif`;ctx.fillStyle=rgb(t.a,.88);ctx.textAlign='center';ctx.fillText(v.ayat,cx,y+W*.038);y+=W*.06;}
  ctx.font=`italic ${W*.052}px 'Great Vibes',cursive`;ctx.fillStyle=t.g2;ctx.textAlign='center';ctx.fillText(v.judul,cx,y+W*.055);y+=W*.07;
  gline(ctx,cx,y,W*.18,t.a,2);y+=W*.032;
  const photoR=W*.14;const photoY=y+photoR+W*.012;
  photoCircle(ctx,photo,cx,photoY,photoR,t.a,6);
  const ap=photoY+photoR;
  const emoji=v.jk==='putri'?'üëß':'üë¶';
  ctx.font=`${W*.028}px serif`;ctx.fillStyle=t.a2;ctx.textAlign='center';ctx.fillText(emoji,cx,ap+W*.038);
  ctx.font=`italic ${W*.056}px 'Great Vibes',cursive`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.082);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.88);ctx.textAlign='center';ctx.fillText(v.anakke+' ¬∑ '+v.tgll,cx,ap+W*.108);
  if(v.showBerat){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.75);ctx.textAlign='center';ctx.fillText(v.berat,cx,ap+W*.13);}
  ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.a,.88);ctx.textAlign='center';ctx.fillText('Aqiqah: '+v.tgla,cx,ap+W*.152);
  gline(ctx,cx,ap+W*.172,W*.3,t.a,1.2);
  ctx.font=`bold ${W*.023}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,ap+W*.208);
  if(v.showKota&&v.kota){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.65);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,ap+W*.23);}
  gline(ctx,cx,ap+W*.252,W*.28,t.a);
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.65);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,ap+W*.278,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.5);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.972);}
}

// ‚îÄ‚îÄ T4: BUNTING PESTA ‚îÄ‚îÄ
function t4(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);const cx=W/2;
  // Bunting flags
  const flagColors=[t.a,'#fbbf24','#34d399','#60a5fa','#f472b6',rgb(t.g,1),t.a2];
  const fw=W*.09,fh=W*.11,fpad=W*.025,startX=W*.04;
  for(let i=0;i<8;i++){buntingFlag(ctx,startX+i*(fw+fpad),H*.035,fw,fh,flagColors[i%flagColors.length]);}
  // Bunting string
  ctx.strokeStyle=rgb(t.g,.65);ctx.lineWidth=2;
  ctx.beginPath();for(let i=0;i<=8;i++){const x=startX+i*(fw+fpad)+fw/2,y=i%2===0?H*.035:H*.058;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);}ctx.stroke();
  if(v.star) sparkles(ctx,W,H*.85,t.g2,t.a2,30);
  if(v.border){ctx.strokeStyle=rgb(t.a,.4);ctx.lineWidth=1.5;ctx.strokeRect(W*.04,H*.17,W*.92,H*.79);}
  if(v.flower){cornerFlowers(ctx,W,H*.18,W*.16,t,'br');cornerFlowers(ctx,0,H,W*.16,t,'tl');}
  let y=H*.2;
  if(v.showAyat){ctx.font=`${W*.034}px 'Amiri',serif`;ctx.fillStyle=rgb(t.a,.9);ctx.textAlign='center';ctx.fillText(v.ayat,cx,y+W*.036);y+=W*.058;}
  ctx.font=`italic ${W*.055}px 'Great Vibes',cursive`;ctx.fillStyle=t.g2;ctx.textAlign='center';ctx.fillText(v.judul,cx,y+W*.058);y+=W*.072;
  gline(ctx,cx,y,W*.3,t.a,1.8);y+=W*.028;
  const photoR=W*.135;const photoY=y+photoR+W*.012;
  const pg=ctx.createRadialGradient(cx,photoY,photoR*.5,cx,photoY,photoR*1.8);pg.addColorStop(0,rgb(t.a,.18));pg.addColorStop(1,'transparent');ctx.fillStyle=pg;ctx.beginPath();ctx.arc(cx,photoY,photoR*1.8,0,Math.PI*2);ctx.fill();
  photoCircle(ctx,photo,cx,photoY,photoR,t.a,7);
  if(v.flower){flower(ctx,cx-photoR-W*.065,photoY,W*.048,t.a,.7);flower(ctx,cx+photoR+W*.065,photoY,W*.048,rgb(t.g,1),.7);}
  const ap=photoY+photoR;
  const emoji=v.jk==='putri'?'üëß':'üë¶';
  ctx.font=`${W*.028}px serif`;ctx.fillStyle=t.a2;ctx.textAlign='center';ctx.fillText(emoji,cx,ap+W*.038);
  ctx.font=`italic ${W*.058}px 'Great Vibes',cursive`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.082);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.85);ctx.textAlign='center';ctx.fillText(v.anakke+' ¬∑ '+v.tgll,cx,ap+W*.108);
  if(v.showBerat){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.75);ctx.textAlign='center';ctx.fillText(v.berat,cx,ap+W*.13);}
  ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.a,.9);ctx.textAlign='center';ctx.fillText('Aqiqah: '+v.tgla,cx,ap+W*.152);
  gline(ctx,cx,ap+W*.17,W*.3,t.a);
  ctx.font=`bold ${W*.023}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,ap+W*.205);
  if(v.showKota&&v.kota){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.65);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,ap+W*.228);}
  ctx.font=`italic ${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.63);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,ap+W*.255,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.5);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.972);}
}

// ‚îÄ‚îÄ T5: OVAL ELEGAN ‚îÄ‚îÄ
function t5(ctx,W,H,t,v,photo,logo){
  bg(ctx,W,H,t);const cx=W/2;
  if(v.star) sparkles(ctx,W,H,t.g2,t.a2,28);
  // Oval frame
  ctx.save();
  ctx.strokeStyle=rgb(t.a,.45);ctx.lineWidth=2;ctx.beginPath();ctx.ellipse(cx,H*.5,W*.44,H*.46,0,0,Math.PI*2);ctx.stroke();
  ctx.strokeStyle=rgb(t.g,.22);ctx.lineWidth=.8;ctx.beginPath();ctx.ellipse(cx,H*.5,W*.4,H*.42,0,0,Math.PI*2);ctx.stroke();
  ctx.restore();
  if(v.flower){for(let i=0;i<10;i++){const a=(i/10)*Math.PI*2;const ex=cx+Math.cos(a)*W*.44,ey=H*.5+Math.sin(a)*H*.46;blossom(ctx,ex,ey,W*.03,i%2===0?t.a:t.g,.65);}}
  if(v.border){ctx.strokeStyle=rgb(t.a,.28);ctx.lineWidth=1;ctx.strokeRect(W*.03,H*.03,W*.94,H*.94);}
  let y=H*.075;
  if(v.showAyat){ctx.font=`${W*.035}px 'Amiri',serif`;ctx.fillStyle=rgb(t.a,.9);ctx.textAlign='center';ctx.fillText(v.ayat,cx,y+W*.037);y+=W*.06;}
  ctx.font=`italic ${W*.05}px 'Great Vibes',cursive`;ctx.fillStyle=t.g2;ctx.textAlign='center';ctx.fillText(v.judul,cx,y+W*.053);y+=W*.068;
  gline(ctx,cx,y,W*.28,t.a,1.5);y+=W*.028;
  const photoR=W*.132;const photoY=y+photoR+W*.012;
  photoCircle(ctx,photo,cx,photoY,photoR,t.g,8);
  const ap=photoY+photoR;
  const emoji=v.jk==='putri'?'üëß':'üë¶';
  ctx.font=`${W*.028}px serif`;ctx.fillStyle=t.a2;ctx.textAlign='center';ctx.fillText(emoji,cx,ap+W*.038);
  ctx.font=`italic ${W*.058}px 'Great Vibes',cursive`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.nama,cx,ap+W*.082);
  ctx.font=`${W*.018}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.88);ctx.textAlign='center';ctx.fillText(v.anakke,cx,ap+W*.108);
  ctx.font=`${W*.017}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.78);ctx.textAlign='center';ctx.fillText(v.tgll+' ¬∑ Aqiqah: '+v.tgla,cx,ap+W*.132);
  if(v.showBerat){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.68);ctx.textAlign='center';ctx.fillText(v.berat,cx,ap+W*.155);}
  gline(ctx,cx,ap+W*.175,W*.3,t.a,1.5);
  ctx.font=`bold ${W*.024}px 'EB Garamond',serif`;ctx.fillStyle=t.ink;ctx.textAlign='center';ctx.fillText(v.ayah+' & '+v.ibu,cx,ap+W*.21);
  if(v.showKota&&v.kota){ctx.font=`${W*.016}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.sub,.65);ctx.textAlign='center';ctx.fillText('üìç '+v.kota,cx,ap+W*.234);}
  gline(ctx,cx,ap+W*.255,W*.26,t.a);
  ctx.font=`italic ${W*.019}px 'EB Garamond',serif`;ctx.fillStyle=rgb(t.ink,.65);ctx.textAlign='center';
  fillW(ctx,v.pesan,cx,ap+W*.28,W*.72,W*.03);
  if(v.social){ctx.font=`${W*.015}px 'Cinzel',serif`;ctx.fillStyle=rgb(t.a,.5);ctx.textAlign='center';ctx.fillText(v.social,cx,H*.972);}
}

const RENDERERS=[t0,t1,t2,t3,t4,t5];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderToCanvas(cv){
  cv.width=S.cw;cv.height=S.ch;
  const ctx=cv.getContext('2d');
  (RENDERERS[S.template]||t0)(ctx,S.cw,S.ch,THEMES[S.theme],getVals(),S.photoImg,S.logoImg);
}
function doRender(){renderToCanvas(document.getElementById('mainCanvas'));renderAllMini();}
function doDownload(){
  const cv=document.getElementById('renderCanvas');
  renderToCanvas(cv);
  const a=document.createElement('a');
  a.download=`aqiqah-${document.getElementById('fNama').value.replace(/\s/g,'-')}-${Date.now()}.png`;
  a.href=cv.toDataURL('image/png',1);a.click();
}
document.getElementById('mainCanvas').onclick=doDownload;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MINI PREVIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMini(cv,tid){
  const W=90,H=120;cv.width=W;cv.height=H;
  const ctx=cv.getContext('2d');const t=THEMES[S.theme];
  const g=ctx.createLinearGradient(0,0,W,H);g.addColorStop(0,t.bg2);g.addColorStop(1,t.bg);ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
  if(tid===2){const rg=ctx.createLinearGradient(0,0,W,H*.14);rg.addColorStop(0,rgb(t.rb,.9));rg.addColorStop(1,rgb(t.rb,.7));ctx.fillStyle=rg;ctx.fillRect(0,0,W,H*.14);}
  if(tid===4){const fColors=[t.a,'#fbbf24','#34d399','#60a5fa','#f472b6'];for(let i=0;i<5;i++){ctx.fillStyle=fColors[i%fColors.length];ctx.beginPath();ctx.moveTo(i*W*.2,H*.04);ctx.lineTo(i*W*.2+W*.18,H*.04);ctx.lineTo(i*W*.2+W*.09,H*.04+H*.1);ctx.closePath();ctx.fill();}}
  if(tid!==2&&tid!==4){ctx.strokeStyle=t.a;ctx.lineWidth=1.5;ctx.strokeRect(3,3,W-6,H-6);}
  // Flowers
  blossom(ctx,W*.82,H*.12,W*.09,t.a,.65);blossom(ctx,W*.15,H*.88,W*.09,rgb(t.g,1),.65);
  // Photo circle
  ctx.beginPath();ctx.arc(W/2,H*.48,W*.17,0,Math.PI*2);ctx.strokeStyle=t.a;ctx.lineWidth=2;ctx.stroke();ctx.fillStyle=rgb(t.a,.1);ctx.fill();
  ctx.font=`${W*.14}px serif`;ctx.fillStyle=rgb('#fff',.25);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('üë∂',W/2,H*.48);ctx.textBaseline='alphabetic';
  // Name
  ctx.font=`italic ${H*.1}px 'Great Vibes',cursive`;ctx.fillStyle=rgb(t.g2,.85);ctx.textAlign='center';ctx.fillText('Aqiqah',W/2,H*.73);
  ctx.font=`${H*.075}px sans-serif`;ctx.fillStyle=rgb(t.ink,.6);ctx.textAlign='center';ctx.fillText('Nama Bayi',W/2,H*.87);
}
function renderAllMini(){document.querySelectorAll('.tmpl-item canvas').forEach((cv,i)=>renderMini(cv,i));}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initTemplates(){
  const grid=document.getElementById('tmplGrid');
  TMPL_NAMES.forEach((n,i)=>{
    const item=document.createElement('div');item.className='tmpl-item'+(i===0?' active':'');
    const cv=document.createElement('canvas');const lbl=document.createElement('div');
    lbl.className='lbl';lbl.textContent=n;item.appendChild(cv);item.appendChild(lbl);
    item.onclick=()=>{document.querySelectorAll('.tmpl-item').forEach(x=>x.classList.remove('active'));item.classList.add('active');S.template=i;doRender();};
    grid.appendChild(item);
  });
}
function initColors(){
  const row=document.getElementById('colorRow');
  THEMES.forEach((t,i)=>{
    const d=document.createElement('div');d.className='cdot'+(i===0?' active':'');
    d.style.background=`linear-gradient(135deg,${t.bg} 40%,${t.a} 100%)`;d.style.borderColor=t.a;d.title=t.n;
    d.onclick=()=>{document.querySelectorAll('.cdot').forEach(x=>x.classList.remove('active'));d.classList.add('active');S.theme=i;doRender();};
    row.appendChild(d);
  });
}
function initSizes(){
  document.querySelectorAll('.spill').forEach(btn=>{
    btn.onclick=()=>{document.querySelectorAll('.spill').forEach(x=>x.classList.remove('active'));btn.classList.add('active');S.cw=+btn.dataset.w;S.ch=+btn.dataset.h;doRender();};
  });
}
function initLive(){
  ['fNama','fTglLahir','fBerat','fTglAqiqah','fAnakKe','fAyah','fIbu','fKota','fAyat','fJudul','fPesan','fSocial'].forEach(id=>document.getElementById(id).addEventListener('input',doRender));
  document.getElementById('fJK').addEventListener('change',doRender);
  ['tFlower','tStar','tBorder','tAyat','tBerat','tKota'].forEach(id=>document.getElementById(id).addEventListener('change',doRender));
}
['photoInput','logoInput'].forEach((id,ki)=>{
  document.getElementById(id).onchange=function(e){
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=ev=>{const img=new Image();img.onload=()=>{S[ki===0?'photoImg':'logoImg']=img;document.getElementById(ki===0?'photoThumb':'logoThumb').src=ev.target.result;document.getElementById(ki===0?'photoThumb':'logoThumb').style.display='block';doRender();};img.src=ev.target.result;};
    r.readAsDataURL(f);
  };
});

initTemplates();initColors();initSizes();initLive();
document.fonts.ready.then(()=>{renderAllMini();doRender();});
setTimeout(()=>{renderAllMini();doRender();},700);
</script>
</body>
</html>
